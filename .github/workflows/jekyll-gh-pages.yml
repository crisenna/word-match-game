<!DOCTYPE html>
<html>
<head>
    <title>æ„æ±‰è¶£å‘³é…å¯¹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #FFD3B6 0%, #A8E6CF 100%);
            display: flex;
            font-family: 'Comic Sans MS', cursive;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* å·¦ä¾§ä¸Šä¼ åŒºåŸŸ */
        #uploadSection {
            width: 250px;
            padding: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-right: 30px;
        }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        #gameContainer {
            flex: 1;
            max-width: 1000px;
            position: relative;
        }

        /* å•è¯åˆ—å¸ƒå±€ */
        .word-column {
            display: grid;
            gap: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        #italianWords {
            grid-template-columns: repeat(3, 1fr);
            background: rgba(255,178,102,0.2);
        }
        #chineseWords {
            grid-template-columns: repeat(4, 1fr);
            background: rgba(102,178,255,0.2);
        }

        /* å•è¯å¡ç‰‡æ ·å¼ */
        .word-card {
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 18px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        #italianWords .word-card {
            background: #FFB366;
        }
        #chineseWords .word-card {
            background: #66B3FF;
        }
        .selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255,255,255,0.8);
        }
        .wrong {
            background: #FF6666 !important;
            animation: shake 0.5s;
        }

        /* æ¸©åº¦è®¡æ ·å¼ */
        #thermometer {
            width: 35px;
            height: 300px;
            background: linear-gradient(to top, #FFA500, #FF6B00);
            border-radius: 20px;
            position: fixed;
            right: 50px;
            top: 100px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        #progress {
            width: 100%;
            background: rgba(255,255,255,0.3);
            transition: height 0.5s ease;
        }

        /* æŒ‰é’®æ ·å¼ */
        button {
            padding: 12px 25px;
            margin: 10px;
            border: none;
            border-radius: 25px;
            background: #4CAF50;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(5px); }
            50% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§ä¸Šä¼ åŒº -->
    <div id="uploadSection">
        <h2>ğŸ“ ä¸Šä¼ è¯åº“</h2>
        <input type="file" id="excelInput" accept=".xlsx,.xls">
        <h3>å½“å‰è¯æ±‡ï¼š</h3>
        <div id="wordList"></div>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="gameContainer">
        <div id="timer">
            <input type="number" id="timeInput" placeholder="å€’è®¡æ—¶(ç§’)" min="1" style="padding: 8px">
            <div id="countdown" style="font-size: 24px; margin: 10px">â³ 00:00</div>
        </div>
        
        <button id="startBtn">ğŸš€ å¼€å§‹æ¸¸æˆ</button>
        <button id="resetBtn">ğŸ”„ é‡æ–°å¼€å§‹</button>

        <div id="gameArea">
            <div class="word-column" id="italianWords"></div>
            <div class="word-column" id="chineseWords"></div>
        </div>
    </div>

    <!-- æ¸©åº¦è®¡ -->
    <div id="thermometer">
        <div id="progress" style="height: 0%"></div>
    </div>

<script>
let words = [];
let selected = { it: null, cn: null };
let timerId = null;
let timeLeft = 0;

// æ–‡ä»¶ä¸Šä¼ å¤„ç†
document.getElementById('excelInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    
    reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        words = XLSX.utils.sheet_to_json(sheet, {header: ['italian', 'chinese']});
        updateWordList();
        generateWordCards();
    };
    reader.readAsArrayBuffer(file);
});

// æ¸¸æˆæ§åˆ¶
document.getElementById('startBtn').addEventListener('click', toggleGame);
document.getElementById('resetBtn').addEventListener('click', resetGame);

function toggleGame() {
    if (!timerId) {
        startGame();
        document.getElementById('startBtn').textContent = 'â¸ æš‚åœ';
    } else {
        clearInterval(timerId);
        timerId = null;
        document.getElementById('startBtn').textContent = 'â–¶ï¸ ç»§ç»­';
    }
}

function startGame() {
    timeLeft = document.getElementById('timeInput').value || 60;
    timeLeft = parseInt(timeLeft);
    updateTimer();
    
    timerId = setInterval(() => {
        timeLeft--;
        updateTimer();
        if (timeLeft <= 0) endGame();
    }, 1000);
}

// ç”Ÿæˆå•è¯å¡ç‰‡
function generateWordCards() {
    const shuffled = [...words].sort(() => Math.random() - 0.5);
    
    // æ„å¤§åˆ©è¯­åˆ—ï¼ˆ3åˆ—ï¼‰
    document.getElementById('italianWords').innerHTML = shuffled
        .map(word => `<div class="word-card" data-word="${word.italian}">${word.italian}</div>`)
        .join('');

    // ä¸­æ–‡åˆ—ï¼ˆ4åˆ—ï¼‰
    document.getElementById('chineseWords').innerHTML = shuffled
        .sort(() => Math.random() - 0.5)
        .map(word => `<div class="word-card" data-word="${word.italian}">${word.chinese}</div>`)
        .join('');

    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.word-card').forEach(card => {
        card.addEventListener('click', handleClick);
    });
}

// ç‚¹å‡»å¤„ç†
function handleClick(e) {
    const card = e.target;
    const isItalian = card.parentElement.id === 'italianWords';

    // æ¸…é™¤å·²é€‰é¡¹
    document.querySelectorAll(`#${isItalian ? 'italian' : 'chinese'}Words .selected`)
        .forEach(c => c.classList.remove('selected'));

    // è®¾ç½®å½“å‰é€‰æ‹©
    card.classList.add('selected');
    isItalian ? selected.it = card : selected.cn = card;

    // å½“é€‰æ‹©ä¸¤ä¸ªå•è¯æ—¶éªŒè¯
    if (selected.it && selected.cn) {
        checkMatch();
    }
}

// éªŒè¯åŒ¹é…
function checkMatch() {
    const isCorrect = words.some(word => 
        word.italian === selected.it.dataset.word && 
        word.chinese === selected.cn.textContent
    );

    if (isCorrect) {
        // æ­£ç¡®åŒ¹é…æ•ˆæœ
        [selected.it, selected.cn].forEach(card => {
            card.style.transition = 'all 0.5s';
            card.style.opacity = '0';
            card.style.transform = 'scale(0)';
            setTimeout(() => card.remove(), 500);
        });
        updateProgress();
    } else {
        // é”™è¯¯æ•ˆæœ
        [selected.it, selected.cn].forEach(card => {
            card.classList.add('wrong');
            setTimeout(() => card.classList.remove('wrong'), 1000);
        });
    }
    selected = { it: null, cn: null };
}

// æ›´æ–°è¿›åº¦æ¡
function updateProgress() {
    const remaining = document.querySelectorAll('.word-card').length;
    const progress = ((words.length*2 - remaining)/2 / words.length * 100).toFixed(1);
    document.getElementById('progress').style.height = progress + '%';
}

// å…¶ä»–åŠŸèƒ½å‡½æ•°
function updateTimer() {
    const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
    const seconds = String(timeLeft % 60).padStart(2, '0');
    document.getElementById('countdown').textContent = `â³ ${minutes}:${seconds}`;
}

function endGame() {
    clearInterval(timerId);
    alert(`æ—¶é—´åˆ°ï¼å®Œæˆåº¦ï¼š${document.getElementById('progress').style.height}`);
}

function resetGame() {
    clearInterval(timerId);
    timerId = null;
    timeLeft = 0;
    updateTimer();
    generateWordCards();
    document.getElementById('progress').style.height = '0%';
    document.getElementById('startBtn').textContent = 'ğŸš€ å¼€å§‹æ¸¸æˆ';
}

function updateWordList() {
    document.getElementById('wordList').innerHTML = 
        words.map(w => `<div>ğŸ• ${w.italian} â†’ ğŸ‡¨ğŸ‡³ ${w.chinese}</div>`).join('');
}
</script>
</body>
</html>
